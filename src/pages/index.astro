---
import "../styles/global.css";
---
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Filler</title>
		<link rel="icon" href="/favicon.ico" />
	</head>
	<body class="bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 min-h-screen flex items-center justify-center">
		<main class="bg-white/80 rounded-xl shadow-lg p-8 w-full max-w-md flex flex-col items-center">
			<h1 class="text-2xl font-bold mb-4">Fill for IG Story</h1>
			<form id="upload-form" class="flex flex-col gap-4 w-full items-center">
				<input type="file" accept="image/*" id="image-input" class="file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100" />
				<div id="preview-container" class="w-[270px] h-[480px] bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 rounded-lg flex items-center justify-center overflow-hidden">
					<img id="preview" class="max-w-full max-h-full object-contain" style="display:none;" />
				</div>
				<button type="button" id="download-btn" class="mt-4 px-4 py-2 bg-pink-600 text-white rounded-lg font-semibold shadow hover:bg-pink-700" style="display:none;">Download Story Image</button>
			</form>
		</main>
		<script>
			const input = document.getElementById('image-input') as HTMLInputElement | null;
			const preview = document.getElementById('preview') as HTMLImageElement | null;
			const downloadBtn = document.getElementById('download-btn') as HTMLButtonElement | null;
			if (input && preview && downloadBtn) {
				input.addEventListener('change', (e) => {
					const file = input.files && input.files[0];
					if (!file) return;
					const reader = new FileReader();
					reader.onload = (ev) => {
						preview.src = ev.target?.result as string;
						preview.style.display = 'block';
						downloadBtn.style.display = 'block';
					};
					reader.readAsDataURL(file);
				});
				downloadBtn.addEventListener('click', () => {
					const canvas = document.createElement('canvas');
					canvas.width = 1080;
					canvas.height = 1920;
					const ctx = canvas.getContext('2d');
					if (!ctx) return;
					// Draw IG gradient
					const grad = ctx.createLinearGradient(0,0,1080,1920);
					grad.addColorStop(0, '#f9ce34');
					grad.addColorStop(0.5, '#ee2a7b');
					grad.addColorStop(1, '#6228d7');
					ctx.fillStyle = grad;
					ctx.fillRect(0,0,1080,1920);
					// Draw image centered and fit
					const img = new window.Image();
					img.onload = () => {
						const ratio = Math.min(1080/img.width, 1920/img.height);
						const w = img.width * ratio;
						const h = img.height * ratio;
						const x = (1080 - w) / 2;
						const y = (1920 - h) / 2;
						ctx.drawImage(img, x, y, w, h);
						const url = canvas.toDataURL('image/jpeg');
						const a = document.createElement('a');
						a.href = url;
						a.download = 'ig-story.jpg';
						a.click();
					};
					img.src = preview.src;
				});
			}
		</script>
	</body>
</html>
